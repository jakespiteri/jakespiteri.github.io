<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Jake Spiteri">
<meta name="description" content="When producing research which involves a lot of code, it is important that your research/analyses can be reproduced. When analyzing data it is common to write some code, change it a little and test some version of your code in the console. Then when your final document is produced, the R script or Markdown document may not produce the exact same results as your published analysis. This is one of the main challenges of producing reproducible research." />
<meta name="keywords" content="statistics, mathematics, data science, machine learning, deep learning" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#252627" />
<link rel="canonical" href="https://jakespiteri.co.uk/portfolio/computing/report-2/" />


    <title>
        
            Portfolio Report 2: Reproducibility :: Jake Spiteri  — Jake Spiteri
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://jakespiteri.co.uk/main.min.7bfbbe12786fa0ded4b4c0d792cbb36a5bd0bdb0b856dde57aa7b1f6fe0f2b87.css">


    
        <link rel="stylesheet" type="text/css" href="static/style.css">
    



    <link rel="apple-touch-icon" sizes="180x180" href="https://jakespiteri.co.uk/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://jakespiteri.co.uk/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://jakespiteri.co.uk/favicon-16x16.png">
    <link rel="manifest" href="https://jakespiteri.co.uk/site.webmanifest">
    <link rel="mask-icon" href="https://jakespiteri.co.uk/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="https://jakespiteri.co.uk/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">

<meta itemprop="name" content="Portfolio Report 2: Reproducibility">
<meta itemprop="description" content="When producing research which involves a lot of code, it is important that your research/analyses can be reproduced. When analyzing data it is common to write some code, change it a little and test some version of your code in the console. Then when your final document is produced, the R script or Markdown document may not produce the exact same results as your published analysis. This is one of the main challenges of producing reproducible research.">

<meta itemprop="wordCount" content="1500">
<meta itemprop="image" content="https://jakespiteri.co.uk"/>



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jakespiteri.co.uk"/>

<meta name="twitter:title" content="Portfolio Report 2: Reproducibility"/>
<meta name="twitter:description" content="When producing research which involves a lot of code, it is important that your research/analyses can be reproduced. When analyzing data it is common to write some code, change it a little and test some version of your code in the console. Then when your final document is produced, the R script or Markdown document may not produce the exact same results as your published analysis. This is one of the main challenges of producing reproducible research."/>












<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-159259654-1', 'auto');
	
	ga('send', 'pageview');
}
</script>





<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css' rel='stylesheet' type='text/css' />



    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://jakespiteri.co.uk/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://jakespiteri.co.uk/about/">About</a></li><li><a href="https://jakespiteri.co.uk/portfolio/">Portfolio</a></li><li><a href="https://jakespiteri.co.uk/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://jakespiteri.co.uk/portfolio/computing/report-2/">Portfolio Report 2: Reproducibility</a></h2>

            

            <div class="post-content">
                


<p>When producing research which involves a lot of code, it is important that your research/analyses can be reproduced. When analyzing data it is common to write some code, change it a little and test some version of your code in the console. Then when your final document is produced, the R script or Markdown document may not produce the exact same results as your published analysis. This is one of the main challenges of producing reproducible research. Whilst it is hard to consistently record all changes in our code, it saves time in the long run.</p>
When undertaking research, there are three main points to consider:

<p>In the following we briefly discuss reproducible research, and then follow with an example demonstrating best practices.</p>
<div id="reproducible-research" class="section level1">
<h1>Reproducible research</h1>
<p>Reproducible research refers to the idea that given an academic paper and the author’s raw data, anyone interested can carry out the <em>exact</em> same computations and produce the same result which was published.</p>
<p>A large portion of academic research is not reproducible. The scientific method revolves around making assumptions, producing hypotheses, and rigorously detailing how a conclusion is produced. Very little computationally-intensive scientific research adequately explains the modelling choices that were made, and so their claims cannot be verified. Some researchers focus on developing different models and architectures which excel at certain tasks, and we are often presented with the model’s prediction/classification performance on an array of datasets. However in producing these results various choices have been made which may not have been adequately explained — we may question how the data was split into train/test sets, how the model’s hyperparameters were chosen, how we can know that the model hasn’t simply overfit the data, etc. Given such complicated experiments, the original authors themselves may not be able to replicate their findings exactly. In some fields such as deep learning, verifying the performance of state-of-the-art (SOTA) algorithms/architectures by training a model from scratch becomes impossible due to the large amount of resources required to re-run experiments. For example, Google has open-sourced the code for its SOTA language model <a href="https://arxiv.org/pdf/1810.04805.pdf">BERT</a>, but the pre-trained model is rumored to have cost $30,000 to train. It would not be possible to re-train BERT without extensive resources. We can of course verify the performance of BERT on an unseen dataset, but we cannot <em>reproduce</em> BERT.</p>
<p>Historically, producing reproducible research has been difficult as it would be very hard to perfectly replicate the original computing environment. A lot of research is also quite interactive. When analyzing data we frequently produce visualizations and test our hypotheses interactively, and we often do not store all of the code we have used. The wealth of tools available to us today make these reasons redundant. Analyses are often carried out with high-level programming languages such as R and Python, which produce the same output when run on different hardware with different operation systems. Package management systems record the computational environment to ensure it can be replicated, and version control systems such as git rigorously keep track of all changes in code. Code can easily be pushed to github and made available to the public.</p>
<p>There are some valid reasons why researchers may not publish their code. Due to the nature of some fields such as healthcare and defense, raw data simply cannot be shared. It is also possible that personal data is being used and for reproducibility data is sometimes released in an anonymized form. Data anonymization is very difficult to do correctly — the <a href="https://en.wikipedia.org/wiki/Netflix_Prize">Netflix Prize</a> is an infamous example in which supposedly <em>anonymous</em> Netflix data was de-anonymized. In 2019 OpenAI published a <a href="https://openai.com/blog/better-language-models/">blog post</a> and <a href="https://cdn.openai.com/better-language-models/language_models_are_unsupervised_multitask_learners.pdf">paper</a> claiming the SOTA performance of their language model GPT-2, but they chose not to publish the full model, the training dataset, and the training code, as they believed it to be too dangerous. Instead they released a much smaller version of GPT-2 and proposed a ‘staged’ release system in which they incrementally released larger versions of GPT-2.</p>
<p>When the Royal Society was founded in 1660, its motto was chosen to be <em>Nullius in verba</em> — Latin for “on the word of no one” or “take nobody’s word for it”. Reproducibility has long been something to strive for. In recent years we have seen the replication crisis appearing in different fields. Psychology has begun a large-scale effort to replicate significant and historical results. Brian Nosek of the Center for Open Science led sixty labs in thirty-six countries in recreating twenty-eight experiments (combined sample sizes were sixty-two times larger than the original experiment on average). Only fourteen of twenty-eight results were successfully replicated.</p>
</div>
<div id="literate-programming" class="section level1">
<h1>Literate programming</h1>
<p>Donald Knuth introduced the concept of literate programming in 1984. The idea is that a computer program or analysis should consist of an explanation of its logic in a natural language such as English, accompanied by snippets of code which carry out the proposed logic. Knuth said that “Instead of imagining that our main task is to instruct a computer what to do, let us concentrate rather on explaining to human beings what we want a computer to do.”.</p>
<p>In practice, we produce a document explaining what a program does in addition to code that can be executed. RMarkdown makes it easy to create documents that ensure code and documentation are consistent with one another, and allows us to emphasize the readability of the document. RMarkdown greatly improves upon simply commenting throughout an R script when producing high-level analyses. However, when working low-level functionality an R script with accompanying documentation is often preferred.</p>
</div>
<div id="example" class="section level1">
<h1>Example</h1>
<p>Here we look at a simple example of literate programming.</p>
<p>Let’s import some data. We will look at Bristol weather data which has been compiled from multiple sources. The source of this .txt file can be found <a href="http://www.bristolweather.org.uk/data.html">here</a>.</p>
<pre class="r"><code>library(readr)
bristoltemps &lt;- read_csv(&quot;data/bristoltemps.txt&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   Year = col_double(),
##   Month = col_double(),
##   Temperature = col_double()
## )</code></pre>
<pre class="r"><code>head(bristoltemps)</code></pre>
<pre><code>## # A tibble: 6 x 3
##    Year Month Temperature
##   &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;
## 1  1853     1           5
## 2  1853     2           1
## 3  1853     3           3
## 4  1853     4           7
## 5  1853     5          11
## 6  1853     6          13</code></pre>
<p>We will use the tidyverse to quickly produce some plots. It may be interesting to view the temperature over a few years to view the periodicity.</p>
<pre class="r"><code># add a date column in the format yyyy-mm-dd
bristoltemps &lt;- bristoltemps %&gt;% 
  mutate(&quot;Date&quot; = as.POSIXct(paste0(Year, &quot;-&quot;, Month, &quot;-01&quot;)))

# create a plot from 2016-2018
bristoltemps %&gt;%
  filter(Year &gt;= 2016) %&gt;%
  ggplot(aes(x = Date, y=Temperature)) +
  geom_line() +
  labs(title = &quot;Average Temperature in Bristol&quot;, 
       subtitle = &quot;From 2016 Onwards&quot;)</code></pre>
<p><img src="https://jakespiteri.co.uk/portfolio/computing/Report-2_files/figure-html/unnamed-chunk-3-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>We may also be interested in the change in the annual temperature in Bristol. Let’s produce a plot of that.</p>
<pre class="r"><code># compute average temperature per year and plot over time
bristoltemps %&gt;%
  group_by(Year) %&gt;%
  summarise(&quot;Average Temperature&quot; = mean(Temperature)) %&gt;%
  ggplot(aes(x = Year, y = `Average Temperature`)) +
  geom_point() +
  labs(title = &quot;Yearly Average Temperature in Bristol&quot;)</code></pre>
<p><img src="https://jakespiteri.co.uk/portfolio/computing/Report-2_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>We seem to be missing some data somewhere between 1850 and 1900. So we will only consider data from the year 1900 onwards. The erratic nature of the data makes it difficult to see a pattern so we will implement a 5 year moving average.</p>
<pre class="r"><code># function that returns the moving average over n values
ma &lt;- function(x, n) {
  return(stats::filter(x, rep(1/n, n), sides=2))
}

# produce a plot with a 5 year average over the data
bristoltemps %&gt;%
  filter(Year &gt;= 1900) %&gt;%
  group_by(Year) %&gt;%
  summarise(&quot;Average Temperature&quot; = mean(Temperature)) %&gt;%
  ggplot(aes(x = Year, y = ma(`Average Temperature`, 5))) +
  geom_line(col=&quot;red&quot;) +
  geom_point(aes(x = Year, y = `Average Temperature`)) +
  labs(title = &quot;Yearly Average Temperature in Bristol&quot;,
       subtitle = &quot;5 Year Moving Average in Red&quot;,
       y = &quot;Average Temperature&quot;)</code></pre>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type ts. Defaulting to continuous.</code></pre>
<p><img src="https://jakespiteri.co.uk/portfolio/computing/Report-2_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>It may be interesting to see the change in temperature relative to an average of the last <span class="math inline">\(30\)</span> years. We redefine our function <code>ma</code> to allow us to average over the past values, and produce a new plot of the differences between the temperature in year <span class="math inline">\(x\)</span> and the average over the last <span class="math inline">\(30\)</span> years.</p>
<p>Note that below we actually compute a moving average over 5 yearly temperatures, and compare this to the average temperature of the last 30 years. This is done because the data is a combination of different datasets from various weather stations in Bristol. The measuring apparatus will change over time.</p>
<pre class="r"><code># function that returns the average over n values
ma &lt;- function(x, n, sides) {
  return(stats::filter(x, rep(1/n, n), sides=sides))
}

# produce plot
bristoltemps %&gt;%
  filter(Year &gt;= 1900) %&gt;%
  group_by(Year) %&gt;%
  summarise(&quot;Average Temperature&quot; = mean(Temperature)) %&gt;%
  mutate(avg_last_thirty_years = ma(`Average Temperature`, 30, sides=1)) %&gt;%
  mutate(diff = ma(`Average Temperature`, 5, sides=2) - avg_last_thirty_years,
         sign = sign(diff)) %&gt;%
  na.omit() %&gt;% 
  ggplot(aes(x = Year, y = diff)) +
  geom_segment(aes(xend = Year, col = as.factor(sign)), yend= 0) +
  scale_colour_manual(values = c(&quot;skyblue&quot;, &quot;red&quot;)) +
  labs(title = &quot;Average Temperature in Bristol&quot;,
       y = &quot;Anomaly From Last Thirty Years&quot;)</code></pre>
<p><img src="https://jakespiteri.co.uk/portfolio/computing/Report-2_files/figure-html/unnamed-chunk-6-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>

            </div>
        </article>

        <hr />

        <div class="post-info">
  			</div>

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="https://jakespiteri.co.uk">Jake Spiteri</a></span>
            
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span> <a href="https://jakespiteri.co.uk/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
    </div>
</footer>
    



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>


    <script src="https://jakespiteri.co.uk/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  </body>
</html>
            
        </div>

        




<script type="text/javascript" src="https://jakespiteri.co.uk/bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js" integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-159259654-1', 'auto');
        ga('send', 'pageview');
    </script>



    </body>
</html>
