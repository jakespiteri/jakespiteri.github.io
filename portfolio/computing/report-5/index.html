<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Jake Spiteri">
<meta name="description" content="Programming paradigms R supports multiple programming paradigms. Programming paradigms describe the way in which code is written and structured for larger projects. The types of programming structures are:
 Imperative programming — We define a sequence of instructions that modify the ‘state’ of the program.  Object-oriented programming — Objects combine the machine’s state with a set of methods. Programs are then defined via the construction of objects.  Declarative programming — A sequence of operations is defined that only specify what the output of the program should be." />
<meta name="keywords" content="statistics, mathematics, data science, machine learning, deep learning" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#252627" />
<link rel="canonical" href="https://jakespiteri.co.uk/portfolio/computing/report-5/" />


    <title>
        
            Portfolio Report 5: Functional and object-oriented programming :: Jake Spiteri  — Jake Spiteri
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://jakespiteri.co.uk/main.min.7bfbbe12786fa0ded4b4c0d792cbb36a5bd0bdb0b856dde57aa7b1f6fe0f2b87.css">


    
        <link rel="stylesheet" type="text/css" href="static/style.css">
    



    <link rel="apple-touch-icon" sizes="180x180" href="https://jakespiteri.co.uk/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://jakespiteri.co.uk/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://jakespiteri.co.uk/favicon-16x16.png">
    <link rel="manifest" href="https://jakespiteri.co.uk/site.webmanifest">
    <link rel="mask-icon" href="https://jakespiteri.co.uk/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="https://jakespiteri.co.uk/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">

<meta itemprop="name" content="Portfolio Report 5: Functional and object-oriented programming">
<meta itemprop="description" content="Programming paradigms R supports multiple programming paradigms. Programming paradigms describe the way in which code is written and structured for larger projects. The types of programming structures are:
 Imperative programming — We define a sequence of instructions that modify the ‘state’ of the program.  Object-oriented programming — Objects combine the machine’s state with a set of methods. Programs are then defined via the construction of objects.  Declarative programming — A sequence of operations is defined that only specify what the output of the program should be.">

<meta itemprop="wordCount" content="2282">
<meta itemprop="image" content="https://jakespiteri.co.uk"/>



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jakespiteri.co.uk"/>

<meta name="twitter:title" content="Portfolio Report 5: Functional and object-oriented programming"/>
<meta name="twitter:description" content="Programming paradigms R supports multiple programming paradigms. Programming paradigms describe the way in which code is written and structured for larger projects. The types of programming structures are:
 Imperative programming — We define a sequence of instructions that modify the ‘state’ of the program.  Object-oriented programming — Objects combine the machine’s state with a set of methods. Programs are then defined via the construction of objects.  Declarative programming — A sequence of operations is defined that only specify what the output of the program should be."/>















<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css' rel='stylesheet' type='text/css' />



    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://jakespiteri.co.uk/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://jakespiteri.co.uk/about/">About</a></li><li><a href="https://jakespiteri.co.uk/portfolio/">Portfolio</a></li><li><a href="https://jakespiteri.co.uk/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://jakespiteri.co.uk/portfolio/computing/report-5/">Portfolio Report 5: Functional and object-oriented programming</a></h2>

            

            <div class="post-content">
                


<div id="programming-paradigms" class="section level1">
<h1>Programming paradigms</h1>
<p>R supports multiple programming paradigms. Programming paradigms describe the way in which code is written and structured for larger projects. The types of programming structures are:</p>
<ul>
<li>Imperative programming — We define a sequence of instructions that modify the ‘state’ of the program.
<ul>
<li>Object-oriented programming — Objects combine the machine’s state with a set of methods. Programs are then defined via the construction of objects.</li>
</ul></li>
<li>Declarative programming — A sequence of operations is defined that only specify what the output of the program should be. The exact details of how the program is implemented is determined by the programming language.</li>
<li>Functional programming — Functions are defined to act identically to mathematical functions. A program is then a sequence of function applications.</li>
</ul>
<p>In this document we will explore the use and applications of functional and object-oriented programming.</p>
</div>
<div id="functional-programming" class="section level1">
<h1>Functional programming</h1>
<div id="first-class-functions" class="section level2">
<h2>First-class functions</h2>
<p>R has first-class functions. These are functions that behave like any other data structure. A language has first-class functions if:</p>
<ul>
<li>Functions can be used as arguments to other functions,</li>
<li>Functions can be returned by functions,</li>
<li>Functions can be stored in data structures.</li>
</ul>
<p>In functional programming we may want to provide a function as an input to another function. We have seen this feature in the <code>Map</code> and <code>Reduce</code> functions in R.</p>
<pre class="r"><code>square &lt;- function(x) x*x
unlist(Map(square, 1:5))</code></pre>
<pre><code>## [1]  1  4  9 16 25</code></pre>
<pre class="r"><code>Reduce(&#39;+&#39;, 1:5)</code></pre>
<pre><code>## [1] 15</code></pre>
<pre class="r"><code>Reduce(&#39;+&#39;, unlist(Map(square, 1:5)))</code></pre>
<pre><code>## [1] 55</code></pre>
<pre class="r"><code># we can also use multiple functions within one function
Reduce(function(x,y) x*y, unlist(Map(square, 1:5)))</code></pre>
<pre><code>## [1] 14400</code></pre>
<p>We can also take a function as an input, manipulate it, and return it as an output.</p>
</div>
<div id="object-oriented-programming" class="section level2">
<h2>Object-oriented programming</h2>
<div id="introduction" class="section level3">
<h3>Introduction</h3>
<p>The main reason to use object-oriented programming (OOP) is <strong>polymorphism</strong>. This provides our functions with reusability and extendability. Polymorphism allows a single object to have multiple methods for various types of input.</p>
<p>In OOP, functionality is <strong>encapsulated</strong> within an <strong>object</strong>. Every object has a type, which is the class that it belongs to. An implementation for a specific class is called a method. The class defines the fields, which contain the data possessed by every instance of that class. The current state of an object is thus specified by its fields, and its behavior is specified by its methods. If one class is derived from the other, the child class may inherit the fields and methods of the parent class.</p>
<p>R implements three different object-oriented systems:</p>
<ul>
<li>S3 — An informal implementation of OOP which relies upon common conventions.</li>
<li>S4 — A formal rewrite of S3.</li>
<li>Reference classes (RC) — Implements encapsulated OOP. In this implementation objects are <strong>mutable</strong>. That is, objects are modified in place.</li>
</ul>
<p>In this report we will look at the S3 and S4 systems.</p>
</div>
<div id="s3" class="section level3">
<h3>S3</h3>
<p>S3 is the simplest and most informal system for OOP in R. S3 does not use formal class definitions. It offers an extremely flexible system, which may allow you to do certain things which are not recommended. Since S3 has few built-in constraints, we will outline best practices here.</p>
<p>An S3 object is an object of a base type with the attribute <code>class</code> set to the class name. It will be good practice to have a constructor function which can be called to initialize all relevant elements of the object, and then return the object. We may also require a validator which checks our arguments within a separate function. A helper function is also useful for end users that makes the constructor more user-friendly.</p>
<p>Below we will implement linear regression as an S3 object.</p>
<pre class="r"><code># we set the seed for reproducibility
set.seed(1)

# create a dataset
n &lt;- 100
w &lt;- matrix(c(2, -1), ncol=1)
X &lt;- rbind(rnorm(100,0,1), rep(1,n))
y &lt;- t(w)%*%X + rnorm(100, 0, 1)
plot(X[1,], y[1,])</code></pre>
<p><img src="https://jakespiteri.co.uk/portfolio/computing/Report-5_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code># we now define a constructor which will return an object of a specified class
# the constructor does some operations
# encapsulates data in the object
# assigns a class to the object
# returns the object
simple_lin_regression &lt;- function(X, y) {
  
  # compute the OLS parameter estimates
  w_hat &lt;- solve(X%*%t(X))%*%X%*%t(y)
  
  # the object encapsulates (X, y, and w_hat)
  slr &lt;- list(response = as.numeric(y), regressor = X, param_estimate = w_hat)
  
  # we declare the object &#39;slr&#39; to be an S3 object of class &quot;simple_lin_regression&quot;
  class(slr) &lt;- &quot;simple_lin_regression&quot;
  
  return(slr)
}

slr &lt;- simple_lin_regression(X, y)</code></pre>
<p>Given the above class simple_lin_regression, we will define some methods for the class. To define a method in S3, a generic function of the same name needs to already exist. If it doesn’t already exist we can easily declare a new generic function.</p>
<p>We define a new method as a function with function name <code>[method_name].[class_name]</code>.</p>
<p>We implement a <code>print</code> method which prints relevant information about the object such as the estimated coefficients, and we implement a <code>plot</code> method. Note that <code>print</code> and <code>plot</code> are already generic methods in <code>R</code> and so we do not need to define them as such here.</p>
<pre class="r"><code>print.simple_lin_regression &lt;- function(x, ...) {
  cat(&quot;head(x) =&quot;, head(x$regressor[1,]), &quot;\n&quot;)
  cat(&quot;head(y) =&quot;, head(x$response), &quot;\n&quot;)
  cat(&quot;Estimated regression: E[y|x] = b0 + b1*x\n&quot;)
  cat(&quot;b0 = &quot;, x$param_estimate[1,1], &quot;, b1 = &quot;, x$param_estimate[2,1], &quot;.\n&quot;, sep=&quot;&quot;)
}

plot.simple_lin_regression &lt;- function(x, ...) {
  plot(x$regressor[1,], slr$response,
       xlab=expression(X), ylab=expression(Y)
  )
  abline(a = x$param_estimate[2], b = x$param_estimate[1], col = &quot;red&quot;)
}</code></pre>
<p>Let’s use the methods we defined above. The correct syntax is <code>[method_name](object])</code>.</p>
<pre class="r"><code>print(slr)</code></pre>
<pre><code>## head(x) = -0.6264538 0.1836433 -0.8356286 1.595281 0.3295078 -0.8204684 
## head(y) = -2.873274 -0.5905975 -3.582179 2.34859 -0.9955691 -0.8736495 
## Estimated regression: E[y|x] = b0 + b1*x
## b0 = 1.99894, b1 = -1.037693.</code></pre>
<pre class="r"><code>plot(slr)</code></pre>
<p><img src="https://jakespiteri.co.uk/portfolio/computing/Report-5_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>We want to define a method called <code>residual_analysis</code>. In order to do this we must define a generic method with the same name.</p>
<pre class="r"><code># define the generic method
residual_analysis &lt;- function(x){
  UseMethod(&quot;residual_analysis&quot;)
}

# implement the method for class
residual_analysis.simple_lin_regression &lt;- function(x) {
  predictions &lt;- t(x$param_estimate) %*% X
  plot(predictions, x$response - predictions,
       main = &quot;Residual analysis&quot;,
       xlab = expression(hat(Y)), ylab = expression(Y-hat(Y)))
}

residual_analysis(slr)</code></pre>
<p><img src="https://jakespiteri.co.uk/portfolio/computing/Report-5_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>In S3, classes can inherit methods from their parent classes. This is demonstrated below. Note that we can create classes on the fly — we not need to formally define them. We simply define an object and then assign its class.</p>
<pre class="r"><code>P &lt;- structure(numeric(), class = &quot;parent_class&quot;)
C &lt;- structure(numeric(), class = c(&quot;child_class&quot;, &quot;parent_class&quot;))

print.parent_class &lt;- function(x) {
  cat(&quot;This method belongs to the parent class&quot;)
}</code></pre>
<p>We check that the method works for both P and C.</p>
<pre class="r"><code>print(P)</code></pre>
<pre><code>## This method belongs to the parent class</code></pre>
<pre class="r"><code>print(C)</code></pre>
<pre><code>## This method belongs to the parent class</code></pre>
<p>We now provide the <code>child_class</code> class with its own print method.</p>
<pre class="r"><code>print.child_class &lt;- function(x) {
  cat(&quot;This method belongs to the child class&quot;)
}

print(C)</code></pre>
<pre><code>## This method belongs to the child class</code></pre>
<pre class="r"><code>print(P)</code></pre>
<pre><code>## This method belongs to the parent class</code></pre>
<pre class="r"><code>print(C)</code></pre>
<pre><code>## This method belongs to the child class</code></pre>
</div>
<div id="s4" class="section level3">
<h3>S4</h3>
<p>S4 implements a more formal approach to OOP. Unlike S3, all OOP relevant elements must be defined explicitly. S4 provides specialized functions for defining elements such as <code>setClass()</code>, <code>setGeneric()</code>, and <code>setMethod()</code>. While this requires more effort, it provides more clarity and allows us to use built-in integrity checks.</p>
<p>We repeat the linear regression task.</p>
<pre class="r"><code>library(methods)</code></pre>
<p>We must first create the <code>simple_lin_regression</code> class. We must give it the name of the class being defined, and the slots which represent the fields’ names and types. Slots can be accessed using the specialized subsetting operator <code>@</code>, however we should avoid using this outside of methods in order to provide encapsulation. In order to obtain or change an object’s components we should use getter and setter methods which we define.</p>
<pre class="r"><code>setClass(&quot;simple_lin_regression&quot;,
         slots = c(
           response = &quot;numeric&quot;,
           regressor = &quot;numeric&quot;,
           estimate = &quot;numeric&quot;
         )
)</code></pre>
<p>We can instantiate a new object in the class using <code>new()</code>. We create a constructor so that the end user does not have to use the <code>new</code> function.</p>
<pre class="r"><code>simple_lin_regression &lt;- function(X,y) {
  slr &lt;- new(&quot;simple_lin_regression&quot;,
             response = y,
             regressor = X)
  return(slr)
}</code></pre>
<p>We quickly test that our constructor function works for our generated data.</p>
<pre class="r"><code>slr &lt;- simple_lin_regression(X[1,1:5],y[1,1:5])
slr</code></pre>
<pre><code>## An object of class &quot;simple_lin_regression&quot;
## Slot &quot;response&quot;:
## [1] -2.8732743 -0.5905975 -3.5821789  2.3485904 -0.9955691
## 
## Slot &quot;regressor&quot;:
## [1] -0.6264538  0.1836433 -0.8356286  1.5952808  0.3295078
## 
## Slot &quot;estimate&quot;:
## numeric(0)</code></pre>
<p>Note that the slot for estimate exists but we have not given it a value yet. It is currently <code>numeric(0)</code>. We will create an initialization method that will compute the estimate when we create an object.</p>
<pre class="r"><code>setMethod(&quot;initialize&quot;, &quot;simple_lin_regression&quot;,
          function(.Object, response, regressor) {
            .Object@response &lt;- response
            .Object@regressor &lt;-  regressor
            
            n &lt;- length(response)
            X &lt;- rbind(regressor, rep(1,n))
            w_hat &lt;- solve(X%*%t(X))%*%X %*% response
            .Object@estimate &lt;- as.numeric(w_hat)
            return(.Object)
          })</code></pre>
<p>When we use the function <code>new()</code> we see that it calls a non-standard generic function <code>initialize()</code>. We can define a custom initialize method that assigns values (such as default values) to an object’s components. We can also perform a computation like above and set its output to one of the object’s components. The first two arguments in the above specify the method <code>initialize</code>, and the class for which it is defined for <code>simple_lin_regression</code>. It returns the object <code>.Object</code> with the components it has been assigned.</p>
<p>Similar to what we did for S3, we implement print and pot functions for S4. Recall that in order to access the components of our object we must use the <code>@</code> operator.</p>
<pre class="r"><code>setMethod(&quot;print&quot;, &quot;simple_lin_regression&quot;,
  function(x, ...) {
    cat(&quot;head(x) =&quot;, head(x@regressor), &quot;\n&quot;)
    cat(&quot;head(y) =&quot;, head(x@response), &quot;\n\n&quot;)
    cat(&quot;Estimated regression: E[y|x] = b0 + b1 * x\n&quot;)
    cat(&quot;b0 = &quot;, x@estimate[1], &quot; and b1 = &quot;, x@estimate[2], &quot;.\n&quot;, sep = &quot;&quot;)
  }
)

setMethod(&quot;plot&quot;, &quot;simple_lin_regression&quot;,
  function(x, y = NULL, ...) {
    plot(x = x@regressor, y = x@response,
         xlab = expression(X), ylab = expression(Y))
    abline(a = x@estimate[2], b = x@estimate[1], col = &quot;red&quot;)
  }
)</code></pre>
<pre class="r"><code>slr &lt;- simple_lin_regression(X[1,], y[1,])
print(slr)</code></pre>
<pre><code>## head(x) = -0.6264538 0.1836433 -0.8356286 1.595281 0.3295078 -0.8204684 
## head(y) = -2.873274 -0.5905975 -3.582179 2.34859 -0.9955691 -0.8736495 
## 
## Estimated regression: E[y|x] = b0 + b1 * x
## b0 = 1.99894 and b1 = -1.037693.</code></pre>
<pre class="r"><code>plot(slr)</code></pre>
<p><img src="https://jakespiteri.co.uk/portfolio/computing/Report-5_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Once again, we implement a method called <code>residual_analysis</code> which is a not a generic method and must be defined using <code>setGeneric()</code>.</p>
<pre class="r"><code>setGeneric(&quot;residual_analysis&quot;)</code></pre>
<pre><code>## [1] &quot;residual_analysis&quot;</code></pre>
<pre class="r"><code>setMethod(&quot;residual_analysis&quot;, &quot;simple_lin_regression&quot;,
          function(x) {
            predictions &lt;- x@estimate[2] + x@estimate[1] * x@regressor
            plot(x = predictions, y = x@response - predictions,
                 xlab = expression(hat(Y)),
                 ylab = expression(Y - hat(Y)))
          })

residual_analysis(slr)</code></pre>
<p><img src="https://jakespiteri.co.uk/portfolio/computing/Report-5_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
</div>
<div id="monte-carlo-example-of-s4" class="section level2">
<h2>Monte carlo example of S4</h2>
<p>We will implement Monte Carlo integration using S4.</p>
<p>We start with the general problem: We want to compute an integral
<span class="math display">\[ \mathbb{E}_f[h(X)] = \int_\mathcal{X} h(x) f(x) dx \]</span>
where <span class="math inline">\(\mathcal{X}\)</span> is the set from which the random variable <span class="math inline">\(X\)</span> takes its values. In order to compute this integral numerically, we are going to generate a sample <span class="math inline">\((X_1, \dots, X_n)\)</span> from the density <span class="math inline">\(f\)</span> and approximate the integral via the empirical mean
<span class="math display">\[ \bar{h}_n := \frac{1}{n} \sum_{i=1}^n h(x_i).\]</span>
This is a logical estimator as <span class="math inline">\(\bar{h}_n \rightarrow \mathbb{E}_f[h(X)]\)</span> as <span class="math inline">\(n \rightarrow \infty\)</span> almost surely (by the Strong Law of Large Numbers).</p>
<p>We implement the above method in a class called <code>monteCarloIntegration</code>.</p>
<pre class="r"><code>setClass(&quot;monteCarloIntegration&quot;,
         slots = c(
           func = &quot;function&quot;,
           lower_lim = &quot;numeric&quot;,
           upper_lim = &quot;numeric&quot;,
           estimates = &quot;numeric&quot;,
           est_errors = &quot;numeric&quot;
         ))</code></pre>
<p>We now create a constructor function.</p>
<pre class="r"><code>monte_carlo_int &lt;- function(func, lower, upper) {
  monte_carlo_integral &lt;- new(&quot;monteCarloIntegration&quot;,
                              func = func, 
                              lower_lim = lower, 
                              upper_lim = upper)
  return(monte_carlo_integral)
}</code></pre>
<p>Let’s test that our constructor works. We are going to integrate the function
<span class="math display">\[h(x) := [\cos(10x) + sin(4x)]^3\]</span>
over [0,1].</p>
<pre class="r"><code>h &lt;- function(x) {(cos(10*x) + sin(4*x))^3}
integral &lt;- monte_carlo_int(h, 0, 1)
integral</code></pre>
<pre><code>## An object of class &quot;monteCarloIntegration&quot;
## Slot &quot;func&quot;:
## function(x) {(cos(10*x) + sin(4*x))^3}
## 
## Slot &quot;lower_lim&quot;:
## [1] 0
## 
## Slot &quot;upper_lim&quot;:
## [1] 1
## 
## Slot &quot;estimates&quot;:
## numeric(0)
## 
## Slot &quot;est_errors&quot;:
## numeric(0)</code></pre>
<p>Our constructor has successfully created our object of class <code>monteCarloIntegration</code>. As soon as we create the object, we want R to compute estimates (we store the cumulative mean) of the integral. We do this with the <code>intialize</code> method. We also compute errors which are explained and used below.</p>
<pre class="r"><code>setMethod(&quot;initialize&quot;, &quot;monteCarloIntegration&quot;,
          function(.Object, func, lower_lim, upper_lim) {
            .Object@func &lt;- func
            .Object@lower_lim &lt;- lower_lim
            .Object@upper_lim &lt;- upper_lim
            
            temp &lt;- func(runif(1e4, lower_lim, upper_lim))
            estimates &lt;- cumsum(temp)/1:1e4
            .Object@estimates &lt;- as.numeric(estimates)
            
            est_errors &lt;- sqrt(cumsum((temp - estimates)^2))/1:1e4
            .Object@est_errors &lt;- as.numeric(est_errors)
            
            return(.Object)
          })</code></pre>
<p>We now construct the object again and perform a sanity check by using the built in R function <code>integrate()</code>.</p>
<pre class="r"><code>integral_mc &lt;- monte_carlo_int(h, 0, 1)

integral_mc@estimates[1e4]</code></pre>
<pre><code>## [1] 0.3644594</code></pre>
<pre class="r"><code>integrate(h, 0, 1)</code></pre>
<pre><code>## 0.4128169 with absolute error &lt; 4.8e-09</code></pre>
<p>We see that our estimates are very close. As stated above, the <code>@</code> operator should not be used outside of methods. It is only used here as we have not yet created getter and setter methods.</p>
<p>We now want to implement a plotting method which will allow us to see if the estimate has converged. We also implement a confidence bound using the asymptotic variance of the approximation
<span class="math display">\[var(\bar{h}_n) = \frac{1}{n} \int_{\mathcal{X}} (h(X) - \mathbb{E}_f[h(X)])f(x)dx\]</span>
which can be estimated using the sample <span class="math inline">\((X_1, \dots, X_n)\)</span>, by
<span class="math display">\[v_n = \frac{1}{n^2} \sum_{j=1}^n [h(x_j) - \bar{h}_n]^2.\]</span>
Using the Central Limit Theorem, for large <span class="math inline">\(n\)</span> we have that
<span class="math display">\[\frac{\bar{h}_n - \mathbb{E}_f[h(X)])f(x)}{\sqrt{(v_n)}}\]</span>
is approximately a standard normal random variable. This then allows us to write down confidence bounds.</p>
<pre class="r"><code>setMethod(&quot;plot&quot;, &quot;monteCarloIntegration&quot;,
          function(x, ...) {
            seq_temp &lt;- seq(x@lower_lim, x@upper_lim, length.out = 1000)
            seq_func &lt;- x@func(seq_temp)
            
            r_est &lt;- integrate(x@func, x@lower_lim, x@upper_lim)$value
            cb_lower &lt;- x@estimates - 2*x@est_errors
            cb_upper &lt;- x@estimates + 2*x@est_errors
            
            par(mfrow=c(1,2))
            plot(seq_temp, seq_func, type = &#39;l&#39;,
                 main = &quot;A plot of h(x) over the interval [0,1]&quot;,
                 xlab = expression(x), ylab = expression(h(x)))
            plot(x@estimates, type = &#39;l&#39;, 
                 ylim = c(0.8*min(cb_lower), 1.2*max(cb_upper)),
                 main = &quot;An approximation of the integral of h(x)&quot;,
                 ylab=&quot;&quot;, xlab=&quot;&quot;)
            polygon(c(1:1e4, 1e4:1), c(cb_lower, rev(cb_upper)),
                    col = adjustcolor(&quot;skyblue&quot;, alpha.f=0.1), border = NA)
            lines(cb_lower, col = &quot;blue&quot;)
            lines(cb_upper, col = &quot;blue&quot;)
            abline(h = r_est, lty = 2, col = &#39;red&#39;)
          })</code></pre>
<pre class="r"><code>plot(integral_mc)</code></pre>
<p><img src="https://jakespiteri.co.uk/portfolio/computing/Report-5_files/figure-html/unnamed-chunk-25-1.png" width="960" /></p>
</div>
</div>

            </div>
        </article>

        <hr />

        <div class="post-info">
  			</div>

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="https://jakespiteri.co.uk">Jake Spiteri</a></span>
            
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span> <a href="https://jakespiteri.co.uk/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
    </div>
</footer>
    



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>


    <script src="https://jakespiteri.co.uk/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  </body>
</html>
            
        </div>

        




<script type="text/javascript" src="https://jakespiteri.co.uk/bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js" integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script>



    </body>
</html>
